using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using System;

public class Table_Stage : Table_Base
{
    [Serializable]
    public class Info
    {
        public int m_nID;
        public int m_nNextID;
        public int m_nType;
        public int[] m_bMonster = new int[6];
        public int[] m_bSideBoss = new int[2];
        public int m_bBoss;
        public int m_nItemMoney;    // 아이템 가격
        public int m_nPotionMoney;        // 포션가격
        public string m_strPrefab;
        public string m_strName;
    }

    public Dictionary<int, Info> m_Dictionary = new Dictionary<int, Info>();


    public Info Get(int _nID)   // 테이블을 가져올때 있으면 출력 없으면 null
    {
        if (m_Dictionary.ContainsKey(_nID))
            return m_Dictionary[_nID];
        return null;
    }

    public void Init_Binary(string _strName)    // 테이블 로드
    {
        Load_Binary<Dictionary<int, Info>>(_strName, ref m_Dictionary); // 값을 내보낸다
    }

    public void Save_Binary(string _strName)    // 테이블 저장
    {
        Save_Binary(_strName, m_Dictionary);
        Debug.Log("[Table Save]" + _strName + ":" + m_Dictionary.Count);
    }

    protected bool _Read(CSVReader _reader,Info _info,int _nRow,int _nstartCol) // 테이블의 정보를 읽어오는 함수
    {
        if (_reader.reset_row(_nRow, _nstartCol) == false)
            return false;
        _reader.get(_nRow, ref _info.m_nID);
        _reader.get(_nRow, ref _info.m_nNextID);
        _reader.get(_nRow, ref _info.m_nType);
        for(int i=0;i<_info.m_bMonster.Length;i++)
        {
            _reader.get(_nRow, ref _info.m_bMonster[i]);
        }
        for (int i = 0; i < _info.m_bSideBoss.Length; i++)
        {
            _reader.get(_nRow, ref _info.m_bSideBoss[i]);
        }
        _reader.get(_nRow, ref _info.m_bBoss);
        _reader.get(_nRow, ref _info.m_nItemMoney);
        _reader.get(_nRow, ref _info.m_nPotionMoney);
        _reader.get(_nRow, ref _info.m_strPrefab);
        _reader.get(_nRow, ref _info.m_strName);

        return true;
    }

    public void Init_CSV(string _strName,int _nStartRow,int _nStartCol) // 테이블을 읽는 함수
    {
        CSVReader reader = GetCSVReader(_strName);
        for(int row = _nStartRow; row < reader.row; row++)
        {
            Info info = new Info();
            if (_Read(reader, info, row, _nStartCol) == false)
                break;
            //Debug.Log("ID = " + info.m_nID + "해당아이디 중복사용");

            m_Dictionary.Add(info.m_nID, info);
        }

        Debug.Log("[Table Load] " + _strName + " : " + m_Dictionary.Count);
    }
}
